# EC2の構成と管理
- 「EC2（Amazon Elastic Compute Cloud）」は、AWSのクラウド上でサーバーを実行するためのサービス

- ハードウェア仮想化方式（HVM）
  - 仮想化ソフトウェアが物理サーバーのハードウェアの差異を吸収し、完全にエミュレーションされたハードウェア環境をOSに提供
　　　　　　　　※エミュレーション：ある装置やソフトウェア、システムの挙動を別のソフトウェアなどによって模倣し、代替として動作させること
　　　　　　　ハードウェアに合わせてOSをカスタマイズする必要がないため、最新のハードウェアをすぐに利用できるメリットがある

- 準仮想化方式（PV）
　　　　- OSが物理サーバーの一部のハードウェアを直接利用できるため、HVM方式に比べて仮想化のオーバーヘッドが少なく、性能面で有利だった
    しかし、OSをPV方式で実行するには、ハードウェアに合わせてOSイメージをカスタマイズする必要があり、
    さらに、HVM方式でもPV方式と同等のパフォーマンスが得られるよう改良されたため、最新の仮想化技術ではPV方式がサポートされなくなっている

- インスタンスファミリー
　　　　- インスタンスの利用目的に合わせて用意された、数種類のハードウェア
  - 主なインスタンスファミリー
    - 汎用：CPU、メモリ、ネットワークパフォーマンスがバランスよく提供される。多くの一般的なアプリケーションに適している
    - コンピューティング最適化：「汎用」と比較すると、CPUの動作クロックが高い。また、同じCPUコア数で比較すると、価格が安い。CPUに依存するワークロード向け
    - ストレージ最適化：インスタンスに物理的にアタッチ（付与）された高速、大容量のストレージを利用できる。データベースソフトウェアに適している
    - メモリ最適化：「汎用」と比較すると、多くのメモリが搭載されている。大量のメモリを必要とする場合に適している
    - 高速コンピューティング：GPUやFPGAを利用可能。機械学習やHPCなどの大規模なワークロードを想定している

- インスタンス世代
  - 新しいものほど数字が大きくなり、性能が高く、価格も安い
  - 古い世代のサポートは継続されるが、新しい世代に移行した方がコスパはいい

- 追加機能
  - d：インスタンスストアを追加したインスタンスファミリー。ストレージ最適化インスタンスファミリーに対する選択肢の1つになる
  - n：ネットワーク帯域幅を追加したインスタンスファミリー
  - a：AMDプロセッサを利用したインスタンスファミリー

- インスタンスサイズ
  - インスタンスファミリーの特徴を保持したまま、さらに必要な性能を選択できます。
  - インスタンスサイズ	vCPU	メモリ（GB）	ネットワーク帯域幅（Gbps）	オンデマンド利用料金（$/時間）
  m5.large	2	8	最大 10	0.124
  m5.xlarge	4	16	最大 10	0.248
  m5.2xlarge	8	32	最大 10	0.496
  m5.4xlarge	16	64	最大 10	0.992
  m5.8xlarge	32	128	10	1.984
  m5.12xlarge	48	192	10	2.976
  m5.16xlarge	64	256	20	3.968
  m5.24xlarge	96	384	25	5.952

- バースト可能インスタンス
  - コストが低いインスタンスでも、短時間だけ高パフォーマンスを得られる（CPUをバーストさせられる）仕組み
  - CPUのアイドル（待機）時間が長いアプリケーションや開発環境、一時的な用途を想定している環境、小規模なデータベースなどで利用され
    - T2インスタンス、T3インスタンスが該当
    - インスタンスサイズごとにCPUパフォーマンスのベースライン（上限）が設けられており、インスタンスの負荷に応じてベースラインを上回ってバーストし、高いレベルのCPU性能を得られる
    - バースト時は、CPUクレジットを消費する。CPUクレジット1つにつき、最大性能を1分間得られる
    - CPUクレジットは、時間の経過によって回復する（回復の割合は、インスタンスサイズによって異なる）
    - Unlimitedモードがあり、このモードにすると24時間で獲得可能な最大クレジット数分のCPUクレジットを前借りして使用できる
    - 前借りしたCPUクレジットを超えてバーストすると、時間あたりの課金が発生する

- ENI（Elastic Network Interface）
  - EC2インスタンスに付与される仮想ネットワークインターフェース
  - インスタンスにはデフォルトで1つのENIがアタッチされており、必要に応じて複数のENIをアタッチできる
  - インスタンスファミリーやインスタンスサイズによって、アタッチ可能なENIの最大数が異なる

- セキュリティグループ
  - セキュリティグループは、インスタンスの通信を遮断する目的で作られる仮想ファイアウォール
    （ファイアウォール：不正な通信がネットワークに侵入することを遮断し、保護するセキュリティ対策機能）
  - セキュリティグループはVPCに複数定義が可能で、インスタンスに対して最大5つまで関連付けられる
    厳密には、セキュリティグループはインスタンスにアタッチされているENIに関連付けられ、そのENIを介した通信のファイアウォールとして機能する
  - 1つのセキュリティグループには、複数のアクセス許可ルールを設定できる（拒否ルールの設定はないので、許可ルールに一致しない通信はすべて遮断される）
  - インスタンスへ入ってくる通信「インバウンドトラフィック」と、インスタンスから出ていく通信「アウトバウンドトラフィック」を別々に設定できる
  - 接続が維持される
    セキュリティグループでは、インバウンドルールに一致したインバウンドトラフィック戻りのアウトバウンドトラフィックは、アウトバウンドルールの設定にかかわらず許可される
  - インバウンドルール
    - タイプ：一般的なアプリケーション用ルールを設定するときは、タイプを選択することで、プロトコルとポート範囲が自動的に設定される
    - プロトコル：許可したい通信のプロトコルを指定。「TCP」、「UDP」、「ICMP」、「ICMPv6」のいずれかを指定。
    - ポート範囲：許可したい通信のポート番号の範囲を指定。「80, 443, 22」のように番号を指定するか、「0-65535」のように範囲で指定。
    - ソース：許可したい通信のソース（送信元）を指定。
      IPアドレス、IPアドレス範囲、またはセキュリティグループを指定。セキュリティグループの場合は、同じVPC内のものを指定。
      セキュリティグループを指定した場合、そのセキュリティグループが関連付けられているインスタンス（正確にはENI）からの通信が許可ルールの対象となる。
    - 説明：そのルールの目的や用途を記載。
  - アウトバウンドルール
    - タイプ：インバウンドルールと同様に、タイプを選択することでプロトコルとポート範囲が自動的に設定される
    - プロトコル：許可したい通信のプロトコルを指定。設定できるプロトコルはインバウンドルールと同様。
    - ポート範囲：ポート範囲：許可したい通信のポート番号の範囲を指定。指定方法はインバウンドルールと同様
    - 送信先：許可したい通信の送信先を指定。指定できるものはインバウンドルールと同様。
    - 説明：そのルールの目的や用途を記載。
  - キーペア
    - EC2にログインするための公開鍵と秘密鍵のためのサービス
    - キーペアはインスタンスにSSHで接続するため、インスタンスに対して設定できるSSHの公開鍵
